<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Settings - oXCookie Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            background: #0a0a0a;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: move 20s linear infinite;
            z-index: 0;
        }
        
        @keyframes move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .glass-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: white;
            font-size: 28px;
            font-weight: 700;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            color: white;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: rgba(120, 119, 198, 0.2);
            border: 1px solid rgba(120, 119, 198, 0.4);
        }
        
        .btn-primary:hover {
            background: rgba(120, 119, 198, 0.3);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
        }
        
        .btn-success:hover {
            background: rgba(16, 185, 129, 0.3);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 14px;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .form-group textarea:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.4);
            border-color: rgba(120, 119, 198, 0.4);
            box-shadow: 0 0 0 3px rgba(120, 119, 198, 0.2);
        }
        
        .form-group small {
            display: block;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            margin-top: 5px;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .alert.success {
            background: rgba(16, 185, 129, 0.2);
            color: #d1fae5;
        }
        
        .alert.error {
            background: rgba(239, 68, 68, 0.2);
            color: #fee2e2;
        }
        
        .notification-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .notification-section:last-child {
            border-bottom: none;
        }
        
        .notification-section h3 {
            color: white;
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                max-width: 100%;
            }
            
            .glass-card {
                padding: 20px;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .notification-section h3 {
                font-size: 18px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 20px;
            }
            
            .glass-card {
                padding: 15px;
            }
            
            .notification-section h3 {
                font-size: 16px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="glass-card header">
            <h1>üîî Notification Settings</h1>
            <a href="/" class="btn btn-primary">‚Üê Back to Dashboard</a>
        </div>
        
        <div id="alert" class="alert"></div>
        
        <div class="glass-card">
            <form id="notifications-form">
                <div class="notification-section">
                    <h3>üç™ Incoming Cookie Notification</h3>
                    <div class="form-group">
                        <label>Notification Text (MarkdownV2 format)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('incoming-cookie', 'default')">üìù Default Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('incoming-cookie', 'detailed')">üìã Detailed Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('incoming-cookie', 'minimal')">‚ú® Minimal Template</button>
                            <button type="button" class="btn btn-success" onclick="testSessionNotification()" id="test-btn" style="margin-left: auto;">üß™ Test Notification</button>
                        </div>
                        <textarea id="incoming-cookie" placeholder="New cookie session detected!"></textarea>
                        <small style="color: rgba(255,255,255,0.6);">This message will be sent when a new cookie session is detected. Uses Telegram MarkdownV2 format. Placeholders: {session_id}, {username}, {password}, {remote_addr}, {useragent}, {create_time}, {update_time}, {time}</small>
                    </div>
                </div>
                
                <div class="notification-section">
                    <h3>üîÑ Updated Cookie Notification</h3>
                    <div class="form-group">
                        <label>Notification Text (MarkdownV2 format)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('updated-cookie', 'default')">üìù Default Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('updated-cookie', 'detailed')">üìã Detailed Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('updated-cookie', 'minimal')">‚ú® Minimal Template</button>
                        </div>
                        <textarea id="updated-cookie" placeholder="Cookie session updated!"></textarea>
                        <small style="color: rgba(255,255,255,0.6);">This message will be sent when an existing cookie session is updated with additional data (tokens, cookies, etc.). Uses Telegram MarkdownV2 format. Placeholders: {session_id}, {username}, {password}, {remote_addr}, {useragent}, {create_time}, {update_time}, {time}</small>
                    </div>
                </div>
                
                <div class="notification-section">
                    <h3>‚öôÔ∏è Status Update Notification</h3>
                    <div class="form-group">
                        <label>Notification Text (MarkdownV2 format)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('status-update', 'default')">üìù Default Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('status-update', 'detailed')">üìã Detailed Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('status-update', 'minimal')">‚ú® Minimal Template</button>
                        </div>
                        <textarea id="status-update" placeholder="System status has been updated."></textarea>
                        <small style="color: rgba(255,255,255,0.6);">This message will be sent when system status changes (monitoring start/stop, etc.). Uses Telegram MarkdownV2 format.</small>
                    </div>
                </div>
                
                <div class="notification-section">
                    <h3>‚è∞ Subscription Warning Notification</h3>
                    <div class="form-group">
                        <label>Notification Text (MarkdownV2 format)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('subscription-warning', 'default')">üìù Default Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('subscription-warning', 'detailed')">üìã Detailed Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('subscription-warning', 'minimal')">‚ú® Minimal Template</button>
                        </div>
                        <textarea id="subscription-warning" placeholder="Your subscription will expire soon. Please renew to continue using the service."></textarea>
                        <small style="color: rgba(255,255,255,0.6);">This message will be sent to admins when their subscription is close to expiring. Uses Telegram MarkdownV2 format.</small>
                    </div>
                </div>
                
                <div class="notification-section">
                    <h3>üéâ Account Extension Notification</h3>
                    <div class="form-group">
                        <label>Notification Text (MarkdownV2 format)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('account-extension', 'default')">üìù Default Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('account-extension', 'detailed')">üìã Detailed Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('account-extension', 'minimal')">‚ú® Minimal Template</button>
                        </div>
                        <textarea id="account-extension" placeholder="Subscription extension message..."></textarea>
                        <small style="color: rgba(255,255,255,0.6);">This message will be sent to admins when their subscription is extended. Uses Telegram MarkdownV2 format. Placeholders: {username}, {days_added}, {expiry_date}, {status}</small>
                    </div>
                </div>
                
                <div class="notification-section" style="border-top: 2px solid rgba(255,255,255,0.1); padding-top: 30px; margin-top: 30px;">
                    <h3>üîí IP Access Warning Notifications</h3>
                    <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">These notifications are sent to normal admin users when they attempt to access the panel from unauthorized IP addresses.</p>
                    
                    <div class="form-group">
                        <label>‚ö†Ô∏è First Warning (1st unauthorized attempt)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('ip-warning-first', 'default')">üìù Default Template</button>
                        </div>
                        <textarea id="ip-warning-first" placeholder="First warning message..."></textarea>
                        <small style="color: rgba(255,255,255,0.6);">Sent on the first unauthorized IP access attempt. Placeholders: {username}, {ip}</small>
                    </div>
                    
                    <div class="form-group">
                        <label>üî¥ Second Warning (2nd unauthorized attempt)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('ip-warning-second', 'default')">üìù Default Template</button>
                        </div>
                        <textarea id="ip-warning-second" placeholder="Second warning message..."></textarea>
                        <small style="color: rgba(255,255,255,0.6);">Sent on the second unauthorized IP access attempt. Placeholders: {username}, {ip}</small>
                    </div>
                    
                    <div class="form-group">
                        <label>üö´ Account Locked (3rd unauthorized attempt)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('ip-warning-locked', 'default')">üìù Default Template</button>
                        </div>
                        <textarea id="ip-warning-locked" placeholder="Account locked message..."></textarea>
                        <small style="color: rgba(255,255,255,0.6);">Sent when account is locked after 3 unauthorized IP access attempts. Placeholders: {username}, {ip}</small>
                    </div>
                    
                    <div class="form-group">
                        <label>‚úÖ Account Access Restored</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('account-restore', 'default')">üìù Default Template</button>
                        </div>
                        <textarea id="account-restore" placeholder="Account restore message..."></textarea>
                        <small style="color: rgba(255,255,255,0.6);">Sent when a locked account's access is restored. Placeholders: {username}, {new_ip_section} (will be empty or contain new IP info)</small>
                    </div>
                </div>
                
                <div class="notification-section">
                    <h3>üöÄ Startup Notification</h3>
                    <div class="form-group">
                        <label>Notification Text (MarkdownV2 format)</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('startup', 'default')">üìù Default Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('startup', 'detailed')">üìã Detailed Template</button>
                            <button type="button" class="btn btn-primary" onclick="prefillTemplate('startup', 'minimal')">‚ú® Minimal Template</button>
                        </div>
                        <textarea id="startup" placeholder="System startup message..."></textarea>
                        <small style="color: rgba(255,255,255,0.6);">This message will be sent to Telegram when the application starts. Uses Telegram MarkdownV2 format.</small>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px;">üíæ Save Notification Settings</button>
            </form>
        </div>
    </div>
    
    <script>
        // Default notification templates (MarkdownV2 format)
        const notificationTemplates = {
            'incoming-cookie': {
                'default': '*üç™ New Cookie Session Captured\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Session Details:*\n‚Ä¢ *ID:* `{session_id}`\n‚Ä¢ *Username:* `{username}`\n‚Ä¢ *Password:* `{password}`\n‚Ä¢ *Remote IP:* `{remote_addr}`\n‚Ä¢ *User Agent:* `{useragent}`\n‚Ä¢ *Created:* `{create_time}`\n‚Ä¢ *Updated:* `{update_time}`\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'detailed': '*üç™ New Cookie Session Captured\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Session Details:*\n‚Ä¢ *ID:* `{session_id}`\n‚Ä¢ *Username:* `{username}`\n‚Ä¢ *Password:* `{password}`\n‚Ä¢ *Remote IP:* `{remote_addr}`\n‚Ä¢ *User Agent:* `{useragent}`\n‚Ä¢ *Created:* `{create_time}`\n‚Ä¢ *Updated:* `{update_time}`\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'minimal': 'üç™ *New Session:* `{session_id}` \\| `{username}` \\| Updated: `{update_time}`'
            },
            'updated-cookie': {
                'default': '*üîÑ Cookie Session Updated\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Session Details:*\n‚Ä¢ *ID:* `{session_id}`\n‚Ä¢ *Username:* `{username}`\n‚Ä¢ *Password:* `{password}`\n‚Ä¢ *Remote IP:* `{remote_addr}`\n‚Ä¢ *User Agent:* `{useragent}`\n‚Ä¢ *Created:* `{create_time}`\n‚Ä¢ *Updated:* `{update_time}`\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'detailed': '*üîÑ Cookie Session Updated\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Session Details:*\n‚Ä¢ *ID:* `{session_id}`\n‚Ä¢ *Username:* `{username}`\n‚Ä¢ *Password:* `{password}`\n‚Ä¢ *Remote IP:* `{remote_addr}`\n‚Ä¢ *User Agent:* `{useragent}`\n‚Ä¢ *Created:* `{create_time}`\n‚Ä¢ *Updated:* `{update_time}`\n\n*Note:* This session has been updated with additional data \\(tokens, cookies, etc\\.\\)\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'minimal': 'üîÑ *Session Updated:* `{session_id}` \\| `{username}` \\| Updated: `{update_time}`'
            },
            'status-update': {
                'default': '*‚öôÔ∏è System Status Changed*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Current Status:*\n‚Ä¢ *Monitoring:* `{monitoring_status}`\n‚Ä¢ *Telegram:* `{telegram_status}`\n‚Ä¢ *Discord:* `{discord_status}`\n‚Ä¢ *Email:* `{email_status}`\n*Admin Information:*\n‚Ä¢ *Admin Status:* `{admin_status}`\n‚Ä¢ *Subscription End Date:* `{subscription_end_date}`\n‚Ä¢ *Updated At:* `{time}`\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'detailed': '*‚öôÔ∏è System Status Changed*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Current Status:*\n‚Ä¢ *Monitoring:* `{monitoring_status}`\n‚Ä¢ *Telegram:* `{telegram_status}`\n‚Ä¢ *Discord:* `{discord_status}`\n‚Ä¢ *Email:* `{email_status}`\n*Admin Information:*\n‚Ä¢ *Admin Status:* `{admin_status}`\n‚Ä¢ *Subscription End Date:* `{subscription_end_date}`\n‚Ä¢ *Updated At:* `{time}`\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'minimal': '‚öôÔ∏è *Status:* `{monitoring_status}` \\| *Admin:* `{admin_status}` \\| *Expires:* `{subscription_end_date}`'
            },
            'subscription-warning': {
                'default': '*‚è∞ Subscription Expiring Soon\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Account:* `{username}`\n*Current Status:* `{status}`\n*Expiry Date:* `{expiry_date}`\n*Days Remaining:* `{days_remaining}`\n\nPlease contact support to renew your subscription\\.\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'detailed': '*‚è∞ Subscription Expiring Soon\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Account:* `{username}`\n*Current Status:* `{status}`\n*Expiry Date:* `{expiry_date}`\n*Days Remaining:* `{days_remaining}`\n\nPlease contact support to renew your subscription\\.\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'minimal': '‚è∞ *Subscription expires:* `{expiry_date}` \\(`{days_remaining}` days\\)'
            },
            'account-extension': {
                'default': '*üéâ Subscription Extended\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Account:* `{username}`\n*Days Added:* `{days_added}`\n*New Expiry Date:* `{expiry_date}`\n*Status:* `{status}`\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'detailed': '*üéâ Subscription Extended\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Account:* `{username}`\n*Days Added:* `{days_added}`\n*New Expiry Date:* `{expiry_date}`\n*Status:* `{status}`\n\nThank you for your continued support\\!\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'minimal': 'üéâ *Subscription Extended\\!* `{days_added}` days added to `{username}` \\(expires: `{expiry_date}`\\)'
            },
            'startup': {
                'default': '*üöÄ oXCookie Manager Started\\!*\n\nSystem is now online and ready to monitor sessions\\.',
                'detailed': '*üöÄ oXCookie Manager Started\\!*\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n*Status:* System Online\n*Time:* `{time}`\n*Ready to monitor sessions\\.*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                'minimal': 'üöÄ *oXCookie Manager Started\\!* System is online\\.'
            },
            'ip-warning-first': {
                'default': '‚ö†Ô∏è *First Warning*\n\nUnauthorized IP access attempt detected for user: *{username}*\n\nIP Address: `{ip}`\n\nThis is your first warning\\. Please use an authorized IP address\\.\n\nRemaining attempts: *2*'
            },
            'ip-warning-second': {
                'default': 'üî¥ *Second Warning*\n\nUnauthorized IP access attempt detected for user: *{username}*\n\nIP Address: `{ip}`\n\nThis is your second warning\\. One more unauthorized attempt will result in account lockout\\.\n\nRemaining attempts: *1*'
            },
            'ip-warning-locked': {
                'default': 'üö´ *Account Locked*\n\nYour account has been locked due to unauthorized IP access attempts\\.\n\nUser: *{username}*\nUnauthorized IP: `{ip}`\n\nYour account has been locked after 3 unauthorized IP access attempts\\. Please contact support to restore access\\.'
            },
            'account-restore': {
                'default': '‚úÖ *Account Access Restored\\!*\n\nYour account access has been restored\\.\n\nUser: *{username}*{new_ip_section}\n\nYou can now log in again\\.'
            }
        };
        
        function prefillTemplate(fieldId, templateType) {
            const textarea = document.getElementById(fieldId);
            if (textarea && notificationTemplates[fieldId] && notificationTemplates[fieldId][templateType]) {
                textarea.value = notificationTemplates[fieldId][templateType];
                showAlert(`Template "${templateType}" loaded!`, 'success');
            }
        }
        
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
        
        async function testSessionNotification() {
            const testBtn = document.getElementById('test-btn');
            const originalText = testBtn.textContent;
            
            // Disable button and show loading state
            testBtn.disabled = true;
            testBtn.textContent = '‚è≥ Sending...';
            testBtn.style.opacity = '0.6';
            
            console.log('[TEST] Starting test notification...');
            console.log('[TEST] URL: /api/notifications/test-session');
            
            try {
                const response = await fetch('/api/notifications/test-session', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'  // Include cookies for session authentication
                });
                
                // Check if response is ok before trying to parse JSON
                if (!response.ok) {
                    // Try to get error message from response
                    let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorMessage;
                    } catch (e) {
                        // If response isn't JSON, use status text
                    }
                    
                    if (response.status === 401) {
                        showAlert('‚ùå Not authenticated. Please login again.', 'error');
                    } else if (response.status === 403) {
                        showAlert('‚ùå Access denied. Super admin privileges required.', 'error');
                    } else if (response.status === 404) {
                        showAlert('‚ùå Endpoint not found. Please refresh the page and try again.', 'error');
                    } else {
                        showAlert(`‚ùå ${errorMessage}`, 'error');
                    }
                    return;
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showAlert(`‚úÖ Test notification sent successfully! Session ID: ${result.session_id} (Username: ${result.username})`, 'success');
                } else {
                    showAlert(`‚ùå ${result.message || 'Failed to send test notification'}`, 'error');
                }
            } catch (error) {
                console.error('Error testing notification:', error);
                showAlert(`‚ùå Network error: ${error.message}. Please check your connection and try again.`, 'error');
            } finally {
                // Re-enable button
                testBtn.disabled = false;
                testBtn.textContent = originalText;
                testBtn.style.opacity = '1';
            }
        }
        
        async function loadNotificationSettings() {
            try {
                const response = await fetch('/api/notifications');
                const data = await response.json();
                
                document.getElementById('incoming-cookie').value = data.incoming_cookie || '';
                document.getElementById('updated-cookie').value = data.updated_cookie || '';
                document.getElementById('status-update').value = data.status_update || '';
                document.getElementById('subscription-warning').value = data.subscription_warning || '';
                document.getElementById('account-extension').value = data.account_extension || '';
                document.getElementById('startup').value = data.startup || '';
                document.getElementById('ip-warning-first').value = data.ip_warning_first || '';
                document.getElementById('ip-warning-second').value = data.ip_warning_second || '';
                document.getElementById('ip-warning-locked').value = data.ip_warning_locked || '';
                document.getElementById('account-restore').value = data.account_restore || '';
            } catch (error) {
                console.error('Error loading notification settings:', error);
                showAlert('Error loading notification settings: ' + error.message, 'error');
            }
        }
        
        document.getElementById('notifications-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const incomingCookie = document.getElementById('incoming-cookie').value;
            const updatedCookie = document.getElementById('updated-cookie').value;
            const statusUpdate = document.getElementById('status-update').value;
            const subscriptionWarning = document.getElementById('subscription-warning').value;
            const accountExtension = document.getElementById('account-extension').value;
            const startup = document.getElementById('startup').value;
            const ipWarningFirst = document.getElementById('ip-warning-first').value;
            const ipWarningSecond = document.getElementById('ip-warning-second').value;
            const ipWarningLocked = document.getElementById('ip-warning-locked').value;
            const accountRestore = document.getElementById('account-restore').value;
            
            try {
                const response = await fetch('/api/notifications', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        incoming_cookie: incomingCookie,
                        updated_cookie: updatedCookie,
                        status_update: statusUpdate,
                        subscription_warning: subscriptionWarning,
                        account_extension: accountExtension,
                        startup: startup,
                        ip_warning_first: ipWarningFirst,
                        ip_warning_second: ipWarningSecond,
                        ip_warning_locked: ipWarningLocked,
                        account_restore: accountRestore
                    })
                });
                
                const result = await response.json();
                if (response.ok) {
                    showAlert('Notification settings saved successfully!', 'success');
                } else {
                    showAlert(result.message || 'Error saving notification settings', 'error');
                }
            } catch (error) {
                showAlert('Error saving notification settings: ' + error.message, 'error');
            }
        });
        
        // Initialize
        loadNotificationSettings();
    </script>
</body>
</html>

